{% extends "base.html" %}
{% block title %}Extaer Información{% endblock %}
{% block content %}
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8">
        <h2>Arrastra o carga tus documentos</h2>
        <form action="" method="post" enctype="multipart/form-data">
          <div class="form-group">
            <input type="file" id="fileInput" class="form-control-file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" multiple>
          </div>
        </form>
        <div id="dropArea" ondragover="handleDragOver(event)">
          <h3 id="fileInfo" style="display: none;">Archivo cargado: <span id="fileName"></span></h3>
        </div>
      </div>
      <div class="col-md-4">
        <h2>Previsualización</h2>
        <div id="previewArea"></div>
      </div>
    </div>
    <button id="extractButton" class="btn btn-primary position-fixed bottom-0 end-0 m-3">Extraer</button>
  </div>

  <script>
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const previewArea = document.getElementById('previewArea');
    const extractButton = document.getElementById('extractButton');
    const fileName = document.getElementById('fileName');

    // Handle file drag and drop
    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'copy';
    }

    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      e.preventDefault();
      let dt = e.dataTransfer;
      let files = dt.files;

      handleFiles(files);
    }

    function handleFiles(files) {
      files = [...files];
      files.forEach(uploadFile);
    }

    function uploadFile(file) {
      fileInfo.style.display = 'block';
      fileName.textContent = file.name;

      // Display the preview of the file
      const fileType = file.type.split('/')[0];
      if (fileType === 'image') {
        const reader = new FileReader();
        reader.onload = (event) => {
          const img = new Image();
          img.src = event.target.result;
          previewArea.innerHTML = '';
          previewArea.appendChild(img);
        };
        reader.readAsDataURL(file);
      } else if (fileType === 'application' && (file.type === 'application/pdf' || file.type === 'application/msword')) {
        const fileUrl = URL.createObjectURL(file);
        const embed = document.createElement('embed');
        embed.src = fileUrl;
        embed.type = file.type;
        embed.width = '100%';
        embed.height = '400px';
        previewArea.innerHTML = '';
        previewArea.appendChild(embed);
      } else {
        previewArea.innerHTML = 'Tipo de archivo no compatible';
      }
    }

    // Handle file input change
    fileInput.addEventListener('change', (event) => {
      handleFiles(event.target.files);
    });

    // Extraer documento
    extractButton.addEventListener('click', extraerDocumento);

    function extraerDocumento() {
      // Lógica para extraer el documento
      console.log('Documento extraído:', fileName.textContent);
    }
  </script>
{% endblock %}